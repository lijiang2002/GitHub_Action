name: Deploy to Server

on:
  push:
    branches:
      - master

jobs:
  build_and_deploy:
    runs-on: macos-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Java
      uses: actions/setup-java@v2
      with:
        java-version: '11'
        distribution: 'adopt'

    - name: Build and test with Maven
      run: mvn clean install
    
    - name: Copy JAR file to server
      run: |
        cp target/Github_Action-0.0.1-SNAPSHOT.jar /Users/lijiang/Documents
        
    - name: SSH into server
      uses: appleboy/ssh-action@master
      with:
        HOST: ${{ secrets.SERVER_IP }}
        USERNAME: ${{ secrets.SERVER_USERNAME }}
        PASSWORD: ${{ secrets.SERVER_PASSWORD }}
        PORT: ${{ secrets.SERVER_PORT }}
        
    - name: Deploy JAR file to server
      run: |
        cd /Users/lijiang/Documents
        sudo java -jar Github_Action-0.0.1-SNAPSHOT.jar &
